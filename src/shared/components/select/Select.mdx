import { Canvas, Meta, Controls, Description } from "@storybook/blocks";
import * as ComponentStories from "./Select.stories";

<Meta of={ComponentStories} />

# Select

`Select` - это компонент выпадающего списка, основанный на [Radix UI Select](https://www.radix-ui.com/primitives/docs/components/select). Он предоставляет удобный интерфейс для выбора одного значения из списка опций. Компонент поддерживает группировку элементов, отключение отдельных опций, кастомные стили и состояния ошибок.

- Основан на `Radix UI Select`
- Поддерживает группировку элементов
- Правильно управляет фокусом
- Поддерживает навигацию с клавиатуры
- Правильно обрабатывает состояния отключения и ошибок
- Поддерживает скринридеры

[Ссылка на Figma](https://www.figma.com/design/lc2aOtrukFLJQwxxgH3Cgm/UI-kit?node-id=16287-4312&p=f&m=dev).

## Структура компонента

- `Select` - корневой компонент
- `SelectTrigger` - триггер для открытия списка
- `SelectValue` - отображение выбранного значения
- `SelectContent` - контейнер для списка опций
- `SelectGroup` - группа опций
- `SelectLabel` - заголовок группы
- `SelectItem` - отдельная опция
- `SelectSeparator` - разделитель между группами
- `SelectScrollUpButton` - кнопка прокрутки вверх
- `SelectScrollDownButton` - кнопка прокрутки вниз

### Базовое использование

<Canvas of={ComponentStories.Default} />

```tsx
import {
	Select,
	SelectContent,
	SelectGroup,
	SelectItem,
	SelectLabel,
	SelectTrigger,
	SelectValue
} from "ics-ui-kit/components/select";

export const Basic = () => {
	return (
		<Select>
			<SelectTrigger>
				<SelectValue placeholder="Выберите фрукт" />
			</SelectTrigger>
			<SelectContent>
				<SelectGroup>
					<SelectLabel>Фрукты</SelectLabel>
					<SelectItem value="apple">Яблоко</SelectItem>
					<SelectItem value="banana">Банан</SelectItem>
					<SelectItem value="orange">Апельсин</SelectItem>
				</SelectGroup>
			</SelectContent>
		</Select>
	);
};
```

### Отключенное состояние

<Canvas of={ComponentStories.Disabled} />

```tsx
import {
	Select,
	SelectContent,
	SelectGroup,
	SelectItem,
	SelectLabel,
	SelectTrigger,
	SelectValue
} from "ics-ui-kit/components/select";

export const Disabled = () => {
	return (
		<Select disabled>
			<SelectTrigger>
				<SelectValue placeholder="Выберите фрукт" />
			</SelectTrigger>
			<SelectContent>
				<SelectGroup>
					<SelectLabel>Фрукты</SelectLabel>
					<SelectItem value="apple">Яблоко</SelectItem>
					<SelectItem value="banana">Банан</SelectItem>
				</SelectGroup>
			</SelectContent>
		</Select>
	);
};
```

### Состояние ошибки

<Canvas of={ComponentStories.Invalid} />

```tsx
import {
	Select,
	SelectContent,
	SelectGroup,
	SelectItem,
	SelectLabel,
	SelectTrigger,
	SelectValue
} from "ics-ui-kit/components/select";

export const Invalid = () => {
	return (
		<Select>
			<SelectTrigger invalid>
				<SelectValue placeholder="Выберите фрукт" />
			</SelectTrigger>
			<SelectContent>
				<SelectGroup>
					<SelectLabel>Фрукты</SelectLabel>
					<SelectItem value="apple">Яблоко</SelectItem>
					<SelectItem value="banana">Банан</SelectItem>
				</SelectGroup>
			</SelectContent>
		</Select>
	);
};
```

### С группами элементов

<Canvas of={ComponentStories.WithGroups} />

```tsx
import {
	Select,
	SelectContent,
	SelectGroup,
	SelectItem,
	SelectLabel,
	SelectTrigger,
	SelectValue
} from "ics-ui-kit/components/select";

export const WithGroups = () => {
	return (
		<Select>
			<SelectTrigger>
				<SelectValue placeholder="Выберите еду" />
			</SelectTrigger>
			<SelectContent>
				<SelectGroup>
					<SelectLabel>Фрукты</SelectLabel>
					<SelectItem value="apple">Яблоко</SelectItem>
					<SelectItem value="banana">Банан</SelectItem>
					<SelectItem value="orange">Апельсин</SelectItem>
				</SelectGroup>
				<SelectGroup>
					<SelectLabel>Овощи</SelectLabel>
					<SelectItem value="carrot">Морковь</SelectItem>
					<SelectItem value="potato">Картофель</SelectItem>
					<SelectItem value="tomato">Томат</SelectItem>
				</SelectGroup>
			</SelectContent>
		</Select>
	);
};
```

### С кнопкой очистки

<Canvas of={ComponentStories.WithClearButton} />

### Свойства

#### Select

- `defaultValue` - значение по умолчанию
- `value` - текущее значение (для контролируемого компонента)
- `onValueChange` - обработчик изменения значения
- `disabled` - отключение компонента
- `name` - имя для формы
- `required` - обязательное поле
- `dir` - направление текста
- `open` - состояние открытия (для контролируемого компонента)
- `onOpenChange` - обработчик изменения состояния открытия

#### SelectTrigger

- `className` - CSS классы
- `invalid` - состояние ошибки
- Все стандартные атрибуты HTML button

#### SelectContent

- `className` - CSS классы
- `position` - позиционирование (popper или item-aligned)
- Все стандартные атрибуты HTML div

#### SelectItem

- `value` - значение опции
- `disabled` - отключение опции
- `className` - CSS классы
- Все стандартные атрибуты HTML div

## Кастомизация компонента

### Кастомизация внешнего вида пункта меню

Компонент `Select` позволяет настраивать внешний вид пунктов меню через примитивы Radix UI.
Для создания кастомных опций используйте следующие компоненты:

- [`SelectOption`](https://www.radix-ui.com/primitives/docs/components/select#item) - базовый компонент для создания опции (аналог `SelectItem` в Radix UI)
- [`SelectItemIndicator`](https://www.radix-ui.com/primitives/docs/components/select#selectitemindicator) - компонент для отображения индикатора выбранного элемента.
- [`SelectItemText`](https://www.radix-ui.com/primitives/docs/components/select#selectitemtext) - компонент для отображения текста элемента.

Эти компоненты являются обертками над примитивами Radix UI и дают полный контроль над отображением пунктов меню.

Минимальный пример кастомного пункта меню:

```tsx
const SimpleSelectOption = ({ value, label }: { value: string; label: string }) => {
	return (
		<SelectOption value={value} asChild>
			{/* Индикатор показывается только у выбранного элемента */}
			<SelectItemIndicator asChild>V </SelectItemIndicator>
			{/* Содержимое SelectItemText отображается в триггере при выборе */}
			<SelectItemText>{label}</SelectItemText>
			{/* Все прочие элементы отображаются только в элементе выпадающего списка */}
			<Icon icon={Trash} className="ml-auto" />
		</SelectOption>
	);
};
```

### Пример кастомизации пункта меню

Рассмотрим пример создания кастомного пункта меню с иконкой и дополнительными элементами управления:

<Canvas of={ComponentStories.WithCustomOption} />

Давайте разберем этот пример по шагам:

#### Шаг 1: Создание компонента кастомной опции

- Компонент состоит из индикатора выбранного элемента, иконки, текста и кнопки для выполнения дополнительного действия.
- Для стилизации используем `MenuItem` и его дочерние компоненты.
- Иконка и текст должны отображаться в качестве значения выбранного элемента. Для этого оборачиваем их в `SelectItemText`.
- Кнопка для выполнения дополнительного действия должна отображаться только в выпадающем списке, поэтому выносим ее за пределы `SelectItemText`.
- Чтобы кнопка действия не вызывала выбор опции, необходимо вызвать `e.stopPropagation()` в обработчике события `onPointerDown`.

```tsx
import { SelectOption, SelectItemIndicator, SelectItemText } from "ics-ui-kit/components/select";
import { MenuItem, MenuItemIconButton, MenuItemIcon, MenuItemText } from "ics-ui-kit/components/menu-item";
import { Icon } from "ics-ui-kit/components/icon";
import { Check, Trash, LucideIcon } from "lucide-react";

const CustomSelectOption = ({ value, label, icon }: { value: string; label: string; icon: LucideIcon }) => {
	return (
		<SelectOption value={value} asChild>
			<MenuItem className="pl-8 lg:pl-8">
				<SelectItemIndicator asChild>
					<Icon icon={Check} className="absolute left-2" />
				</SelectItemIndicator>
				<SelectItemText asChild>
					<span className="flex flex-row items-center gap-2">
						<MenuItemIcon icon={icon} />
						<MenuItemText>{label}</MenuItemText>
					</span>
				</SelectItemText>
				<MenuItemIconButton
					icon={Trash}
					className="ml-auto"
					onPointerDown={(e) => {
						e.stopPropagation();
						alert(`Удалить хранилище ${label}`);
					}}
				/>
			</MenuItem>
		</SelectOption>
	);
};
```

#### Шаг 2: Использование кастомной опции в Select

```tsx
function WithCustomOption() {
	return (
		<Select>
			<SelectTrigger>
				<SelectValue placeholder="Выберите хранилище" />
			</SelectTrigger>
			<SelectContent>
				<SelectGroup>
					<CustomSelectOption value="gitlab" label="gitlab" icon={Gitlab} />
					<CustomSelectOption value="github" label="github" icon={Github} />
					<CustomSelectOption value="gramax" label="git self-hosted" icon={GitBranch} />
				</SelectGroup>
			</SelectContent>
		</Select>
	);
}
```

#### Шаг 3: Добавление кастомного пункта меню

Кастомный пункт меню можно реализовать как обычный пункт меню `SelectOption`, но с дополнительной обработкой:

- Переводим компонент в controlled-режим, с помощью свойств `value` и `onValueChange` в `Select`.
- Пункт меню с системным действием отмечаем специальным `value`.
- Обрабатываем системные действия в `onValueChange` отдельно:
    - Если выбрано системное действие, то выполняем нужную бизнес-логику.
    - Если выбрано другое значение, то обновляем `value` в `Select`.

```tsx
import {
	Select,
	SelectContent,
	SelectGroup,
	SelectOption,
	SelectSeparator,
	SelectTrigger,
	SelectValue
} from "ics-ui-kit/components/select";
import { MenuItem, MenuItemActionTemplate } from "ics-ui-kit/components/menu-item";
import { Plus, Gitlab, Github, GitBranch } from "lucide-react";

const SYSTEM_ACTION_VALUE = "system_action";

function WithCustomOption() {
	const [open, setOpen] = useState(false);
	const [value, setValue] = useState<string | undefined>(undefined);

	return (
		<Select
			open={open}
			onOpenChange={setOpen}
			value={value}
			onValueChange={(newValue) => {
				if (newValue === SYSTEM_ACTION_VALUE) {
					alert("Добавить новое хранилище");
					return;
				}
				setValue(newValue);
			}}
		>
			<SelectTrigger>
				<SelectValue placeholder="Выберите хранилище" />
			</SelectTrigger>
			<SelectContent>
				<SelectGroup>
					<CustomSelectOption value="gitlab" label="gitlab" icon={Gitlab} />
					<CustomSelectOption value="github" label="github" icon={Github} />
					<CustomSelectOption value="gramax" label="git self-hosted" icon={GitBranch} />
				</SelectGroup>
				<SelectSeparator />
				<SelectOption value={SYSTEM_ACTION_VALUE} asChild role="button" aria-label="Добавить новое хранилище">
					<MenuItem>
						<MenuItemActionTemplate icon={Plus} text="Добавить новое хранилище" />
					</MenuItem>
				</SelectOption>
			</SelectContent>
		</Select>
	);
}
```

В итоге получается компонент с расширенной функциональностью, сохраняющий все стандартные возможности Select:

- Выбор опций
- Отключение отдельных пунктов
- Навигация с клавиатуры
- Дополнительные действия
